
<!DOCTYPE html>
<html>
<head>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta charset="UTF-8">

</head>

<body>
<!--Import Google Icon Font-->
<link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!-- Compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">

<div class="container">
    <h3>Registro de Propuesta</h3>
    <div class="divider"></div>
    <h5>Sobre la Propuesta</h5>
    <div class="row">
        <div class="input-field col s12 m6">
            <select id="modalidades">
                <option value="" disabled selected>Elija la modalidad de su propuesta</option>
            </select>
            <label>Modalidad</label>
        </div>
    </div>
    <div class="divider"></div>
    <div class="section">
        <h5>Participantes</h5>
        <p">Requerimos saber cuántas personas han participado en su proyecto para poder registrar a cada una de ellas.</p>

        <div class="row">
            <div class="input-field col m6 s12">
                <select id="participantes">
                    <option value="1">1 participante (usted)</option>
                    <option value="2">2 participantes (usted y un socio)</option>
                    <option value="3">3 participantes (usted y dos socios)</option>
                    <option value="4">4 participantes (usted y tres socios)</option>
                </select>
            </div>
            <div class="col m6 s12">
                aqui van las notificaciones
            </div>
        </div>

        <div class="row" id="expandParticipantes" >
            <div class="col m6 s12" id="form-participantes">
                <form class="card-panel grey lighten-4">
                    <h5>Participante </h5>

                    <div class="row">
                        <div class="input-field col m4 s12">
                            <i class="material-icons prefix">account_circle</i>
                            <input id="nombre" type="text" class="validate">
                            <label for="nombre">Nombre</label>
                        </div>
                        <div class="input-field col m4 s12">
                            <input id="paterno" type="text" class="validate">
                            <label for="paterno">Apellido paterno</label>
                        </div>
                        <div class="input-field col m4 s12">
                            <input id="materno" type="text" class="validate">
                            <label for="materno">Apellido materno</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s7">
                            <i class="material-icons prefix">picture_in_picture</i>
                            <label style="margin-top:-5px;margin-bottom: 5px;">Documento</label>
                            <p style="margin-top: 25px;" name>
                                <input class="with-gap" name="group1" type="radio" id="doc1" />
                                <label for="doc1">DNI</label>
                                <input class="with-gap" name="group1" type="radio" id="doc2" />
                                <label for="doc2">C.E.</label>
                                <input class="with-gap" name="group1" type="radio" id="doc3"  />
                                <label for="doc3">Pasaporte</label>
                            </p>
                        </div>

                        <div class="input-field col s5">
                            <input id="docnum" type="number" class="validate">
                            <label for="docnum"># de documento</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s7">
                            <i class="material-icons prefix">business</i>
                            <input id="institucion" type="text" class="validate">
                            <label for="institucion">Institución</label>
                        </div>
                        <div class="input-field col s5">
                            <select name="paises" class="paises">
                                <option value="" disabled selected>Elija su país</option>
                                <!-- ListarPais(); -->
                            </select>
                            <label>País</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s7">
                            <i class="material-icons prefix">email</i>
                            <input id="email" type="email" class="validate">
                            <label for="email" data-error="email no válido" data-success="válido">Email</label>
                        </div>
                        <div class="input-field col s5">
                            <i class="material-icons prefix">phone</i>
                            <input id="telefono" type="number" class="validate">
                            <label for="telefono">Teléfono</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col s8">
                            <h6>Esta persona es...</h6>
                            <p>
                                <input type="checkbox" class="filled-in" id="tipo1"/>
                                <label for="tipo1">Expositor</label>
                                <input type="checkbox" class="filled-in" id="tipo2"/>
                                <label for="tipo2">Coordinador</label>
                            </p>

                        </div>
                        <div class="col s4 right">
                            <button class="waves-effect waves-light btn-large right" type="submit" name="guardar">Guardar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="divider"></div>
    <div class="section" id="expand">
        <h5>Primeras modalidades</h5>
        <div class="row">
            <div class="input-field col s12 m6" >
                <select id="tematica">
                    <option value="" disabled selected>Elija la línea temática de su propuesta</option>
                </select>
                <label>Línea temática</label>
            </div>

            <div class="input-field col s12 m6 hide" id="otra-tematica">
                <input id="paterno" type="text" class="validate">
                <label for="paterno">Indicar la otra temática</label>
            </div>
        </div>
        
        <div class="row">
            <div class="input-field col s12 m6" >
                <select id="nivel-educativo">
                    <option value="" disabled selected>Elija el nivel educativo de su propuesta</option>
                </select>
                <label>Nivel educativo</label>
            </div>
        </div>

        <div class="row">
            <div class="file-field input-field">
                <div class="btn">
                    <span>Adjuntar</span>
                    <input type="file">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Resumen ejecutivo">
                </div>
            </div>

            <div class="file-field input-field">
                <div class="btn">
                    <span>Adjuntar</span>
                    <input type="file">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Resumen para evaluar">
                </div>
            </div>
        </div>
    </div>

</div>


<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>

<script>
    var paises = cargarPais();
    var cantParticipantes = 1;
    var participanteForm = $('#form-participantes').clone();

    function addIdSuffixToInput(suffix, form){
        var inputs = form.find('input');
        $.each(inputs, function(i, val){
            var input = $(val);
            var actualId = input.attr('id');
            input.attr('id', actualId.concat('-', suffix));
        });
    }

    //escucha el select de participantes
    function onChangeParticipantes(){
        var val = $('#participantes').val();
        var expandParticipantes = $('#expandParticipantes');

        if (val > cantParticipantes) {
            for (var i = cantParticipantes; i < val; i++) {
                var aux = participanteForm.clone();
                participanteForm.attr('id', participanteForm.attr('id').concat('-', i-1));
                addIdSuffixToInput(i-1, participanteForm);
                expandParticipantes.append(participanteForm);
                participanteForm = aux;
            }
        }
        else if (val < cantParticipantes) {
            var forms = expandParticipantes.find('form');
            for (var i = cantParticipantes-val; i > 0; i--) {
                forms.get(forms.length-i).remove();
            }
        }
        participanteForm = participanteForm.clone();
        cantParticipantes = val;
        $('select').material_select();
    }

    function cargarFormParticipantes(){

    }

    function cargarPais(){
        var datos;
        jQuery(function($) {
            $.ajax({
                type: 'POST',
                url: 'WS/ListarPais.php',
                success: function(data) {
                    try{
                         JSON.parse(data);
                    } catch(err) {
                        console.log('error en ws');
                    }
                    var pre = JSON.parse(data);
                    datos = pre;
                    var sel = $('.paises');
                    /**
                    for(i=0;i<pre.length;i++){
                        sel.append('<option value="'+pre[i].CO_PAIS+'" data-DUIS="'+pre[i].ID_PAIS+'">'+pre[i].NO_PAIS+'</option>')
                    }
                     **/
                    $('select').material_select();
                }
            });
        });
    return datos;
    }

    function ListarLineaTematica(){
        jQuery(function($) {
            $.ajax({
                type: 'POST',
                url: 'WS/ListarLineaTematica.php',
                success: function(data) {
                    try{
                        JSON.parse(data);
                    } catch(err) {
                        console.log('error en ws');
                    }
                    var pre = JSON.parse(data);
                    var sel = $('#tematica');
                    for(i=0;i<pre.length;i++){
                        sel.append('<option value="'+pre[i].ID_LINEA_TEMATICA+'">'+pre[i].NO_LINEA_TEMATICA+'</option>');
                    }
                    $('select').material_select();
                }
            });
        });
    }

    function ListarNivelEducativo(){
        jQuery(function($) {
            $.ajax({
                type: 'POST',
                url: 'WS/ListarNivelEducativo.php',
                success: function(data) {
                    try{
                        JSON.parse(data);
                    } catch(err) {
                        console.log('error en ws');
                    }
                    var pre = JSON.parse(data);
                    var sel = $('#nivel-educativo');
                    for(i=0;i<pre.length;i++){
                        sel.append('<option value="'+pre[i].ID_NIVEL_EDUCATIVO+'">'+pre[i].TX_NIVEL_EDUCATIVO+'</option>')
                    }
                    $('select').material_select();
                }
            });
        });
    }

    function ListarModalidad(){
        jQuery(function($) {
            $.ajax({
                type: 'POST',
                url: 'WS/ListarModalidad.php',
                success: function(data) {
                    try{
                        JSON.parse(data);
                    } catch(err) {
                        console.log('error en ws');
                    }
                    var pre = JSON.parse(data);
                    var sel = $('#modalidades');
                    for(i=0;i<pre.length;i++){
                        sel.append('<option value="'+pre[i].ID_MODALIDAD+'" data-DUIS="'+pre[i].ID_PAIS+'">'+pre[i].NO_MODALIDAD+'</option>')
                    }
                    $('select').material_select();
                }
            });
        });
    }

    //Listener para ampliar el formulario
    $('#modalidades').change(function(){
        var val = $('#modalidades').val();
        console.log(val);
        if(val<=5){
            //Floro
            Mostrar1();
        }else if (val==6){
            //Fotografía
            Mostrar2();
        }else{
            //Video
            Mostrar3();
        }
    });





    //Lo dejo para reusar luego
    function ListarModalidadDeprecated(){
        jQuery(function($) {
            $.ajax({
                type: 'POST',
                url: 'WS/ListarModalidad.php',
                success: function(data) {
                    try{
                        JSON.parse(data);
                    } catch(err) {
                        alert('error en ws');
                    }
                    var pre = JSON.parse(data);
                    console.log(pre);
                    var sel = $('#modalidades');
                    for(i=0;i<pre.length;i++){
                        sel.append('<p><input class="with-gap" name="group1" type="radio" id="p'+pre[i].ID_MODALIDAD+'" data-DUIS="'+pre[i].ID_MODALIDAD+'"/>\
                                <label for="p'+pre[i].ID_MODALIDAD+'">'+pre[i].NO_MODALIDAD+'</label></p>');
                    }
                }
            });
        });
    }

    function onChangeTematica(){
        if ($('#tematica').val() == 24){
            $('#otra-tematica').removeClass('hide');
        }
        else{
            $('#otra-tematica').addClass('hide');
        }
    }

</script>
<script>
    //ListarPais();
    ListarModalidad();
    ListarLineaTematica();
    ListarNivelEducativo();

    $('#tematica').change(onChangeTematica);
    $('#participantes').change(onChangeParticipantes);

    $('select').material_select();
</script>

</body>
</html>
        